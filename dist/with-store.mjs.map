{"version":3,"file":"with-store.mjs","sources":["../src/with-store.mjs"],"sourcesContent":["export function withStore (store, options) {\n  return {\n    ...options,\n    created () {\n      // create a subscription callback\n      this._subscribeCallback = () => {\n        // clear the getter cache\n        this.computedCache = {}\n\n        // Run the render processor now that there's changes\n        this._processRender()\n      }\n      this.setStore(store)\n      if (options.created) options.created.call(this)\n    },\n    mounted () {\n      this._subscribeToStores(false)\n      if (options.mounted) options.mounted.call(this)\n    },\n    updated () {\n      this._subscribeToStores(false)\n      if (options.updated) options.updated.call(this)\n    },\n    removed () {\n      this._unsubscribeFromStores()\n      if (options.removed) options.removed.call(this)\n    },\n    setStore (store) {\n      this.store = store\n      this._subscribeToStores()\n    },\n    _subscribeToStores (invokeSubscribeCallback = true) {\n      if (this.store && this.store.subscribe && typeof this.store.subscribe === 'function' && !this.unsubscribe) {\n        this.unsubscribe = this.store.subscribe(this._subscribeCallback)\n        if (invokeSubscribeCallback) this._subscribeCallback()\n      } else if (this.store && typeof this.store === 'object' && !this.store.subscribe) {\n        this.unsubscribe = {}\n        const keys = Object.keys(this.store)\n        keys.forEach(k => {\n          if (this.store[k] && this.store[k].subscribe && typeof this.store[k].subscribe === 'function' && !this.unsubscribe[k]) {\n            this.unsubscribe[k] = this.store[k].subscribe(this._subscribeCallback)\n          }\n        })\n        if (invokeSubscribeCallback) this._subscribeCallback()\n      }\n    },\n    _unsubscribeFromStores () {\n      if (this.store && this.unsubscribe && typeof this.unsubscribe === 'object') {\n        const keys = Object.keys(this.unsubscribe)\n        keys.forEach(k => {\n          this.unsubscribe[k]()\n        })\n        this.unsubscribe = null\n      } else if (this.store && this.unsubscribe && typeof this.unsubscribe === 'function') {\n        this.unsubscribe()\n        this.unsubscribe = null\n      }\n    }\n  }\n}\n"],"names":["withStore","store","options","created","this","_subscribeCallback","computedCache","_processRender","setStore","call","mounted","_subscribeToStores","updated","removed","_unsubscribeFromStores","invokeSubscribeCallback","subscribe","unsubscribe","Object","keys","forEach","k"],"mappings":"AAAO,SAASA,UAAWC,EAAOC,GAChC,MAAO,IACFA,EACHC,UAEEC,KAAKC,mBAAqB,KAExBD,KAAKE,cAAgB,CAAE,EAGvBF,KAAKG,gBAAgB,EAEvBH,KAAKI,SAASP,GACVC,EAAQC,SAASD,EAAQC,QAAQM,KAAKL,KAC3C,EACDM,UACEN,KAAKO,oBAAmB,GACpBT,EAAQQ,SAASR,EAAQQ,QAAQD,KAAKL,KAC3C,EACDQ,UACER,KAAKO,oBAAmB,GACpBT,EAAQU,SAASV,EAAQU,QAAQH,KAAKL,KAC3C,EACDS,UACET,KAAKU,yBACDZ,EAAQW,SAASX,EAAQW,QAAQJ,KAAKL,KAC3C,EACDI,SAAUP,GACRG,KAAKH,MAAQA,EACbG,KAAKO,oBACN,EACDA,mBAAoBI,GAA0B,GAC5C,GAAIX,KAAKH,OAASG,KAAKH,MAAMe,WAA6C,mBAAzBZ,KAAKH,MAAMe,YAA6BZ,KAAKa,YAC5Fb,KAAKa,YAAcb,KAAKH,MAAMe,UAAUZ,KAAKC,oBACzCU,GAAyBX,KAAKC,0BAC7B,GAAID,KAAKH,OAA+B,iBAAfG,KAAKH,QAAuBG,KAAKH,MAAMe,UAAW,CAChFZ,KAAKa,YAAc,CAAE,EACRC,OAAOC,KAAKf,KAAKH,OACzBmB,SAAQC,IACPjB,KAAKH,MAAMoB,IAAMjB,KAAKH,MAAMoB,GAAGL,WAAgD,mBAA5BZ,KAAKH,MAAMoB,GAAGL,YAA6BZ,KAAKa,YAAYI,KACjHjB,KAAKa,YAAYI,GAAKjB,KAAKH,MAAMoB,GAAGL,UAAUZ,KAAKC,oBACpD,IAECU,GAAyBX,KAAKC,oBACnC,CACF,EACDS,yBACE,GAAIV,KAAKH,OAASG,KAAKa,aAA2C,iBAArBb,KAAKa,YAA0B,CAC7DC,OAAOC,KAAKf,KAAKa,aACzBG,SAAQC,IACXjB,KAAKa,YAAYI,IAAI,IAEvBjB,KAAKa,YAAc,IAC3B,MAAiBb,KAAKH,OAASG,KAAKa,aAA2C,mBAArBb,KAAKa,cACvDb,KAAKa,cACLb,KAAKa,YAAc,KAEtB,EAEL"}