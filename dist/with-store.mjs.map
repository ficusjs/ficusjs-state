{"version":3,"file":"with-store.mjs","sources":["../src/with-store.mjs"],"sourcesContent":["export function withStore (store, options) {\n  return {\n    ...options,\n    created () {\n      // create a subscription callback\n      this._subscribeCallback = () => {\n        // clear the getter cache\n        this.computedCache = {}\n\n        // Run the render processor now that there's changes\n        this.isCreatedCalled && this._processRender()\n      }\n      this.setStore(store)\n      if (options.created) options.created.call(this)\n    },\n    mounted () {\n      this._subscribeToStores(false)\n      if (options.mounted) options.mounted.call(this)\n    },\n    updated () {\n      this._subscribeToStores(false)\n      if (options.updated) options.updated.call(this)\n    },\n    removed () {\n      this._unsubscribeFromStores()\n      if (options.removed) options.removed.call(this)\n    },\n    setStore (store) {\n      this.store = store\n      this._subscribeToStores()\n    },\n    _subscribeToStores (invokeSubscribeCallback = true) {\n      if (this.store && this.store.subscribe && typeof this.store.subscribe === 'function' && !this.unsubscribe) {\n        this.unsubscribe = this.store.subscribe(this._subscribeCallback)\n        if (invokeSubscribeCallback) this._subscribeCallback()\n      } else if (this.store && typeof this.store === 'object' && !this.store.subscribe) {\n        this.unsubscribe = {}\n        const keys = Object.keys(this.store)\n        keys.forEach(k => {\n          if (this.store[k] && this.store[k].subscribe && typeof this.store[k].subscribe === 'function' && !this.unsubscribe[k]) {\n            this.unsubscribe[k] = this.store[k].subscribe(this._subscribeCallback)\n          }\n        })\n        if (invokeSubscribeCallback) this._subscribeCallback()\n      }\n    },\n    _unsubscribeFromStores () {\n      if (this.store && this.unsubscribe && typeof this.unsubscribe === 'object') {\n        const keys = Object.keys(this.unsubscribe)\n        keys.forEach(k => {\n          this.unsubscribe[k]()\n        })\n        this.unsubscribe = null\n      } else if (this.store && this.unsubscribe && typeof this.unsubscribe === 'function') {\n        this.unsubscribe()\n        this.unsubscribe = null\n      }\n    }\n  }\n}\n"],"names":["withStore","store","options","created","this","_subscribeCallback","computedCache","isCreatedCalled","_processRender","setStore","call","mounted","_subscribeToStores","updated","removed","_unsubscribeFromStores","invokeSubscribeCallback","subscribe","unsubscribe","Object","keys","forEach","k"],"mappings":"AAAO,SAASA,UAAWC,EAAOC,GAChC,MAAO,IACFA,EACHC,UAEEC,KAAKC,mBAAqB,KAExBD,KAAKE,cAAgB,CAAE,EAGvBF,KAAKG,iBAAmBH,KAAKI,gBAAgB,EAE/CJ,KAAKK,SAASR,GACVC,EAAQC,SAASD,EAAQC,QAAQO,KAAKN,KAC3C,EACDO,UACEP,KAAKQ,oBAAmB,GACpBV,EAAQS,SAAST,EAAQS,QAAQD,KAAKN,KAC3C,EACDS,UACET,KAAKQ,oBAAmB,GACpBV,EAAQW,SAASX,EAAQW,QAAQH,KAAKN,KAC3C,EACDU,UACEV,KAAKW,yBACDb,EAAQY,SAASZ,EAAQY,QAAQJ,KAAKN,KAC3C,EACDK,SAAUR,GACRG,KAAKH,MAAQA,EACbG,KAAKQ,oBACN,EACDA,mBAAoBI,GAA0B,GAC5C,GAAIZ,KAAKH,OAASG,KAAKH,MAAMgB,WAA6C,mBAAzBb,KAAKH,MAAMgB,YAA6Bb,KAAKc,YAC5Fd,KAAKc,YAAcd,KAAKH,MAAMgB,UAAUb,KAAKC,oBACzCW,GAAyBZ,KAAKC,0BAC7B,GAAID,KAAKH,OAA+B,iBAAfG,KAAKH,QAAuBG,KAAKH,MAAMgB,UAAW,CAChFb,KAAKc,YAAc,CAAE,EACRC,OAAOC,KAAKhB,KAAKH,OACzBoB,SAAQC,IACPlB,KAAKH,MAAMqB,IAAMlB,KAAKH,MAAMqB,GAAGL,WAAgD,mBAA5Bb,KAAKH,MAAMqB,GAAGL,YAA6Bb,KAAKc,YAAYI,KACjHlB,KAAKc,YAAYI,GAAKlB,KAAKH,MAAMqB,GAAGL,UAAUb,KAAKC,oBACpD,IAECW,GAAyBZ,KAAKC,oBACnC,CACF,EACDU,yBACE,GAAIX,KAAKH,OAASG,KAAKc,aAA2C,iBAArBd,KAAKc,YAA0B,CAC7DC,OAAOC,KAAKhB,KAAKc,aACzBG,SAAQC,IACXlB,KAAKc,YAAYI,IAAI,IAEvBlB,KAAKc,YAAc,IAC3B,MAAiBd,KAAKH,OAASG,KAAKc,aAA2C,mBAArBd,KAAKc,cACvDd,KAAKc,cACLd,KAAKc,YAAc,KAEtB,EAEL"}