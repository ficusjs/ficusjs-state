{"version":3,"file":"xstate-service.mjs","sources":["../src/lib/xstate-fsm.mjs","../src/base-persist.mjs","../src/util/wrap-xstate-service.mjs","../src/xstate-service.mjs"],"sourcesContent":["/*! *****************************************************************************\nCopyright (c) Microsoft Corporation.\n\nPermission to use, copy, modify, and/or distribute this software for any\npurpose with or without fee is hereby granted.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\nPERFORMANCE OF THIS SOFTWARE.\n***************************************************************************** */\nfunction t(t,n){var e=\"function\"==typeof Symbol&&t[Symbol.iterator];if(!e)return t;var r,o,i=e.call(t),a=[];try{for(;(void 0===n||n-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(e=i.return)&&e.call(i)}finally{if(o)throw o.error}}return a}var n;!function(t){t[t.NotStarted=0]=\"NotStarted\",t[t.Running=1]=\"Running\",t[t.Stopped=2]=\"Stopped\"}(n||(n={}));var e={type:\"xstate.init\"};function r(t){return void 0===t?[]:[].concat(t)}function o(t){return{type:\"xstate.assign\",assignment:t}}function i(t,n){return\"string\"==typeof(t=\"string\"==typeof t&&n&&n[t]?n[t]:t)?{type:t}:\"function\"==typeof t?{type:t.name,exec:t}:t}function a(t){return function(n){return t===n}}function u(t){return\"string\"==typeof t?{type:t}:t}function c(t,n){return{value:t,context:n,actions:[],changed:!1,matches:a(t)}}function f(t,n,e){var r=n,o=!1;return[t.filter((function(t){if(\"xstate.assign\"===t.type){o=!0;var n=Object.assign({},r);return\"function\"==typeof t.assignment?n=t.assignment(r,e):Object.keys(t.assignment).forEach((function(o){n[o]=\"function\"==typeof t.assignment[o]?t.assignment[o](r,e):t.assignment[o]})),r=n,!1}return!0})),r,o]}function s(n,o){void 0===o&&(o={});var s=t(f(r(n.states[n.initial].entry).map((function(t){return i(t,o.actions)})),n.context,e),2),l=s[0],y=s[1],p={config:n,_options:o,initialState:{value:n.initial,actions:l,context:y,matches:a(n.initial)},transition:function(e,o){var s,l,y=\"string\"==typeof e?{value:e,context:n.context}:e,v=y.value,g=y.context,d=u(o),x=n.states[v];if(x.on){var h=r(x.on[d.type]);\"*\"in x.on&&h.push.apply(h,function(t,n,e){if(e||2===arguments.length)for(var r,o=0,i=n.length;o<i;o++)!r&&o in n||(r||(r=Array.prototype.slice.call(n,0,o)),r[o]=n[o]);return t.concat(r||Array.prototype.slice.call(n))}([],t(r(x.on[\"*\"])),!1));try{for(var m=function(t){var n=\"function\"==typeof Symbol&&Symbol.iterator,e=n&&t[n],r=0;if(e)return e.call(t);if(t&&\"number\"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(n?\"Object is not iterable.\":\"Symbol.iterator is not defined.\")}(h),b=m.next();!b.done;b=m.next()){var S=b.value;if(void 0===S)return c(v,g);var w=\"string\"==typeof S?{target:S}:S,j=w.target,E=w.actions,R=void 0===E?[]:E,N=w.cond,O=void 0===N?function(){return!0}:N,_=void 0===j,A=null!=j?j:v,k=n.states[A];if(O(g,d)){var T=t(f((_?r(R):[].concat(x.exit,R,k.entry).filter((function(t){return t}))).map((function(t){return i(t,p._options.actions)})),g,d),3),q=T[0],z=T[1],B=T[2],C=null!=j?j:v;return{value:C,context:z,actions:q,changed:j!==v||q.length>0||B,matches:a(C)}}}}catch(t){s={error:t}}finally{try{b&&!b.done&&(l=m.return)&&l.call(m)}finally{if(s)throw s.error}}}return c(v,g)}};return p}var l=function(t,n){return t.actions.forEach((function(e){var r=e.exec;return r&&r(t.context,n)}))};function y(t){var r=t.initialState,o=n.NotStarted,i=new Set,c={_machine:t,send:function(e){o===n.Running&&(r=t.transition(r,e),l(r,u(e)),i.forEach((function(t){return t(r)})))},subscribe:function(t){return i.add(t),t(r),{unsubscribe:function(){return i.delete(t)}}},start:function(i){if(i){var u=\"object\"==typeof i?i:{context:t.config.context,value:i};r={value:u.value,actions:[],context:u.context,matches:a(u.value)}}else r=t.initialState;return o=n.Running,l(r,e),c},stop:function(){return o=n.Stopped,i.clear(),c},get state(){return r},get status(){return o}};return c}export{n as InterpreterStatus,o as assign,s as createMachine,y as interpret};\n","class BasePersist {\n  /**\n   * Create an instance of persistence with the unique namespace identifier\n   * @param {string} namespace\n   * @param {object} storage\n   * @param {object} options\n   */\n  constructor (namespace, storage, options = {}) {\n    this.namespace = namespace\n    this.storage = storage\n    this.options = options\n    this._init()\n  }\n\n  /**\n   * Private method for initializing\n   * @private\n   */\n  _init () {\n    if ('performance' in globalThis && this.options.clearOnReload) {\n      // @ts-ignore\n      const entries = globalThis.performance.getEntriesByType('navigation').map(e => e.type)\n      const lastUpdated = this.lastUpdated()\n      if (lastUpdated && entries.includes('reload')) {\n        this.removeState()\n      }\n    }\n  }\n\n  /**\n   * Set state in the persistence store\n   * @param {*} state\n   */\n  setState (state) {\n    if (state) {\n      this.storage.setItem(`${this.namespace}:state`, this._normalizeState(state))\n      this.storage.setItem(`${this.namespace}:lastUpdated`, new Date().getTime().toString())\n    } else {\n      this.removeState()\n    }\n  }\n\n  /**\n   * Normalize state before persisting\n   * @param state\n   * @returns {string}\n   * @private\n   */\n  _normalizeState (state) {\n    if (typeof state === 'object' && (this.options.saveState && typeof this.options.saveState === 'function')) {\n      return JSON.stringify(this.options.saveState(state))\n    } else if (typeof state !== 'string') {\n      return JSON.stringify(state)\n    }\n    return state\n  }\n\n  /**\n   * Get state from the persistence store\n   * @returns {*}\n   */\n  getState () {\n    const state = this.storage.getItem(`${this.namespace}:state`)\n    return state ? JSON.parse(state) : undefined\n  }\n\n  /**\n   * Get the last updated time in milliseconds since the Unix Epoch\n   * @returns {number}\n   */\n  lastUpdated () {\n    const lastUpdated = this.storage.getItem(`${this.namespace}:lastUpdated`)\n    return lastUpdated ? parseInt(lastUpdated, 10) : undefined\n  }\n\n  /**\n   * Remove state from the persistence store\n   */\n  removeState () {\n    this.storage.removeItem(`${this.namespace}:state`)\n    this.storage.removeItem(`${this.namespace}:lastUpdated`)\n  }\n}\n\n/**\n * Function to create persistence for the store\n * @param {string} namespace\n * @param {string} [storageName]\n * @param {object} [options]\n * @returns {BasePersist}\n */\nfunction createPersist (namespace, storageName = 'session', options) {\n  if (storageName === 'local') {\n    return new BasePersist(namespace, globalThis.localStorage, options)\n  }\n  return new BasePersist(namespace, globalThis.sessionStorage, options)\n}\n\nexport { BasePersist, createPersist }\n","import { createPersist } from '../base-persist.mjs'\n\nexport function wrapXStateService (service, getters, persist) {\n  const wrappedService = {\n    _xstateService: service,\n    _getterCache: {},\n    _persist: typeof persist === 'string' ? createPersist(persist) : persist,\n    get status () {\n      if (!this._xstateService) return XStateServiceStatus.INIT\n      return this._xstateService.status\n    },\n    get state () {\n      return this._xstateService.state\n    },\n    subscribe (callback) {\n      return this._xstateService.subscribe(() => {\n        this._getterCache = {}\n        if (this._persist && this._xstateService.status === XStateServiceStatus.RUNNING) {\n          this._persist.setState(this._xstateService.state)\n        }\n        callback()\n      })\n    },\n    send (action) {\n      this._xstateService.send(action)\n    },\n    start () {\n      this._xstateService.start(this._persist ? this._persist.getState() : undefined)\n    }\n  }\n  if (getters) {\n    wrappedService.getters = new Proxy(getters, {\n      get (getters, key) {\n        if (!wrappedService._getterCache[key]) {\n          const result = getters[key](wrappedService._xstateService.state.context)\n          wrappedService._getterCache[key] = result\n        }\n        return wrappedService._getterCache[key]\n      }\n    })\n  }\n  return wrappedService\n}\n\nexport const XStateServiceStatus = Object.freeze({\n  INIT: -1,\n  NOT_STARTED: 0,\n  RUNNING: 1,\n  STOPPED: 2\n})\n","import { assign, createMachine, interpret as interpretXState } from './lib/xstate-fsm.mjs'\nimport { wrapXStateService, XStateServiceStatus } from './util/wrap-xstate-service.mjs'\n\nfunction interpret (machine, getters, persist) {\n  const service = wrapXStateService(interpretXState(machine), getters, persist)\n  return service\n}\n\nfunction createXStateService (key, machine, getters, persist) {\n  const service = interpret(machine, getters, persist)\n  globalThis.__ficusjs__ = globalThis.__ficusjs__ || {}\n  globalThis.__ficusjs__.xstate = globalThis.__ficusjs__.xstate || {}\n  globalThis.__ficusjs__.xstate[key] = service\n  return service\n}\n\nfunction addXStateService (key, service) {\n  globalThis.__ficusjs__ = globalThis.__ficusjs__ || {}\n  globalThis.__ficusjs__.xstate = globalThis.__ficusjs__.xstate || {}\n  globalThis.__ficusjs__.xstate[key] = service\n  return service\n}\n\nfunction getXStateService (key) {\n  if (globalThis.__ficusjs__ && globalThis.__ficusjs__.xstate && globalThis.__ficusjs__.xstate[key]) {\n    return globalThis.__ficusjs__.xstate[key]\n  }\n}\n\nexport {\n  XStateServiceStatus,\n  addXStateService,\n  assign,\n  createMachine,\n  createXStateService,\n  getXStateService,\n  interpret,\n  wrapXStateService\n}\n"],"names":["t","n","e","Symbol","iterator","r","o","i","call","a","next","done","push","value","error","return","NotStarted","Running","Stopped","type","concat","assignment","name","exec","u","c","context","actions","changed","matches","f","filter","Object","assign","keys","forEach","s","states","initial","entry","map","l","y","p","config","_options","initialState","transition","v","g","d","x","on","h","apply","arguments","length","Array","prototype","slice","m","TypeError","b","S","w","target","j","E","R","N","cond","O","_","A","k","T","exit","q","z","B","C","BasePersist","constructor","namespace","storage","options","this","_init","globalThis","clearOnReload","entries","performance","getEntriesByType","lastUpdated","includes","removeState","setState","state","setItem","_normalizeState","Date","getTime","toString","saveState","JSON","stringify","getState","getItem","parse","undefined","parseInt","removeItem","createPersist","storageName","localStorage","sessionStorage","wrapXStateService","service","getters","persist","wrappedService","_xstateService","_getterCache","_persist","status","XStateServiceStatus","INIT","subscribe","callback","RUNNING","send","action","start","Proxy","get","key","result","freeze","NOT_STARTED","STOPPED","interpret","machine","Set","_machine","add","unsubscribe","delete","stop","clear","interpretXState","createXStateService","__ficusjs__","xstate","addXStateService","getXStateService"],"mappings":";;;;;;;;;;;;;;AAcA,SAASA,EAAEA,EAAEC,GAAG,IAAIC,EAAE,mBAAmBC,QAAQH,EAAEG,OAAOC,UAAU,IAAIF,EAAE,OAAOF,EAAE,IAAIK,EAAEC,EAAEC,EAAEL,EAAEM,KAAKR,GAAGS,EAAE,GAAG,IAAI,WAAM,IAASR,GAAGA,KAAK,MAAMI,EAAEE,EAAEG,QAAQC,MAAMF,EAAEG,KAAKP,EAAEQ,MAAM,CAAC,MAAMb,GAAGM,EAAE,CAACQ,MAAMd,EAAE,CAAC,QAAQ,IAAIK,IAAIA,EAAEM,OAAOT,EAAEK,EAAEQ,SAASb,EAAEM,KAAKD,EAAE,CAAC,QAAQ,GAAGD,EAAE,MAAMA,EAAEQ,KAAK,CAAC,CAAC,OAAOL,CAAC,CAAC,IAAIR,GAAG,SAASD,GAAGA,EAAEA,EAAEgB,WAAW,GAAG,aAAahB,EAAEA,EAAEiB,QAAQ,GAAG,UAAUjB,EAAEA,EAAEkB,QAAQ,GAAG,SAAS,CAA5F,CAA8FjB,IAAIA,EAAE,KAAK,IAAIC,EAAE,CAACiB,KAAK,eAAe,SAASd,EAAEL,GAAG,YAAO,IAASA,EAAE,GAAG,GAAGoB,OAAOpB,EAAE,CAAC,SAASM,EAAEN,GAAG,MAAM,CAACmB,KAAK,gBAAgBE,WAAWrB,EAAE,CAAC,SAASO,EAAEP,EAAEC,GAAG,MAAM,iBAAiBD,EAAE,iBAAiBA,GAAGC,GAAGA,EAAED,GAAGC,EAAED,GAAGA,GAAG,CAACmB,KAAKnB,GAAG,mBAAmBA,EAAE,CAACmB,KAAKnB,EAAEsB,KAAKC,KAAKvB,GAAGA,CAAC,CAAC,SAASS,EAAET,GAAG,OAAO,SAASC,GAAG,OAAOD,IAAIC,CAAC,CAAC,CAAC,SAASuB,EAAExB,GAAG,MAAM,iBAAiBA,EAAE,CAACmB,KAAKnB,GAAGA,CAAC,CAAC,SAASyB,EAAEzB,EAAEC,GAAG,MAAM,CAACY,MAAMb,EAAE0B,QAAQzB,EAAE0B,QAAQ,GAAGC,SAAQ,EAAGC,QAAQpB,EAAET,GAAG,CAAC,SAAS8B,EAAE9B,EAAEC,EAAEC,GAAG,IAAIG,EAAEJ,EAAEK,GAAE,EAAG,MAAM,CAACN,EAAE+B,QAAM,SAAW/B,GAAG,GAAG,kBAAkBA,EAAEmB,KAAK,CAACb,GAAE,EAAG,IAAIL,EAAE+B,OAAOC,OAAO,CAAA,EAAG5B,GAAG,MAAM,mBAAmBL,EAAEqB,WAAWpB,EAAED,EAAEqB,WAAWhB,EAAEH,GAAG8B,OAAOE,KAAKlC,EAAEqB,YAAYc,SAAO,SAAW7B,GAAGL,EAAEK,GAAG,mBAAmBN,EAAEqB,WAAWf,GAAGN,EAAEqB,WAAWf,GAAGD,EAAEH,GAAGF,EAAEqB,WAAWf,EAAG,IAAGD,EAAEJ,GAAE,CAAE,CAAC,OAAM,CAAG,IAAGI,EAAEC,EAAE,CAAC,SAAS8B,EAAEnC,EAAEK,QAAG,IAASA,IAAIA,EAAE,IAAI,IAAI8B,EAAEpC,EAAE8B,EAAEzB,EAAEJ,EAAEoC,OAAOpC,EAAEqC,SAASC,OAAOC,cAAcxC,GAAG,OAAOO,EAAEP,EAAEM,EAAEqB,QAAS,IAAG1B,EAAEyB,QAAQxB,GAAG,GAAGuC,EAAEL,EAAE,GAAGM,EAAEN,EAAE,GAAGO,EAAE,CAACC,OAAO3C,EAAE4C,SAASvC,EAAEwC,aAAa,CAACjC,MAAMZ,EAAEqC,QAAQX,QAAQc,EAAEf,QAAQgB,EAAEb,QAAQpB,EAAER,EAAEqC,UAAUS,WAAW,SAAS7C,EAAEI,GAAG,IAAI8B,EAAEK,EAAEC,EAAE,iBAAiBxC,EAAE,CAACW,MAAMX,EAAEwB,QAAQzB,EAAEyB,SAASxB,EAAE8C,EAAEN,EAAE7B,MAAMoC,EAAEP,EAAEhB,QAAQwB,EAAE1B,EAAElB,GAAG6C,EAAElD,EAAEoC,OAAOW,GAAG,GAAGG,EAAEC,GAAG,CAAC,IAAIC,EAAEhD,EAAE8C,EAAEC,GAAGF,EAAE/B,OAAO,MAAMgC,EAAEC,IAAIC,EAAEzC,KAAK0C,MAAMD,EAAE,SAASrD,EAAEC,EAAEC,GAAG,GAAGA,GAAG,IAAIqD,UAAUC,OAAO,IAAI,IAAInD,EAAEC,EAAE,EAAEC,EAAEN,EAAEuD,OAAOlD,EAAEC,EAAED,KAAKD,GAAGC,KAAKL,IAAII,IAAIA,EAAEoD,MAAMC,UAAUC,MAAMnD,KAAKP,EAAE,EAAEK,IAAID,EAAEC,GAAGL,EAAEK,IAAI,OAAON,EAAEoB,OAAOf,GAAGoD,MAAMC,UAAUC,MAAMnD,KAAKP,GAAG,CAA9L,CAAgM,GAAGD,EAAEK,EAAE8C,EAAEC,GAAG,QAAO,IAAK,IAAI,IAAI,IAAIQ,EAAE,SAAS5D,GAAG,IAAIC,EAAE,mBAAmBE,QAAQA,OAAOC,SAASF,EAAED,GAAGD,EAAEC,GAAGI,EAAE,EAAE,GAAGH,EAAE,OAAOA,EAAEM,KAAKR,GAAG,GAAGA,GAAG,iBAAiBA,EAAEwD,OAAO,MAAM,CAAC9C,KAAK,WAAW,OAAOV,GAAGK,GAAGL,EAAEwD,SAASxD,OAAE,GAAQ,CAACa,MAAMb,GAAGA,EAAEK,KAAKM,MAAMX,EAAE,GAAG,MAAM,IAAI6D,UAAU5D,EAAE,0BAA0B,kCAAkC,CAAxS,CAA0SoD,GAAGS,EAAEF,EAAElD,QAAQoD,EAAEnD,KAAKmD,EAAEF,EAAElD,OAAO,CAAC,IAAIqD,EAAED,EAAEjD,MAAM,QAAG,IAASkD,EAAE,OAAOtC,EAAEuB,EAAEC,GAAG,IAAIe,EAAE,iBAAiBD,EAAE,CAACE,OAAOF,GAAGA,EAAEG,EAAEF,EAAEC,OAAOE,EAAEH,EAAErC,QAAQyC,OAAE,IAASD,EAAE,GAAGA,EAAEE,EAAEL,EAAEM,KAAKC,OAAE,IAASF,EAAE,WAAW,OAAM,CAAE,EAAEA,EAAEG,OAAE,IAASN,EAAEO,EAAE,MAAMP,EAAEA,EAAElB,EAAE0B,EAAEzE,EAAEoC,OAAOoC,GAAG,GAAGF,EAAEtB,EAAEC,GAAG,CAAC,IAAIyB,EAAE3E,EAAE8B,GAAG0C,EAAEnE,EAAE+D,GAAG,GAAGhD,OAAO+B,EAAEyB,KAAKR,EAAEM,EAAEnC,OAAOR,QAAQ,SAAS/B,GAAG,OAAOA,CAAE,KAAIwC,KAAG,SAAWxC,GAAG,OAAOO,EAAEP,EAAE2C,EAAEE,SAASlB,QAAS,IAAGsB,EAAEC,GAAG,GAAG2B,EAAEF,EAAE,GAAGG,EAAEH,EAAE,GAAGI,EAAEJ,EAAE,GAAGK,EAAE,MAAMd,EAAEA,EAAElB,EAAE,MAAM,CAACnC,MAAMmE,EAAEtD,QAAQoD,EAAEnD,QAAQkD,EAAEjD,QAAQsC,IAAIlB,GAAG6B,EAAErB,OAAO,GAAGuB,EAAElD,QAAQpB,EAAEuE,GAAG,CAAC,CAAC,CAAC,MAAMhF,GAAGoC,EAAE,CAACtB,MAAMd,EAAE,CAAC,QAAQ,IAAI8D,IAAIA,EAAEnD,OAAO8B,EAAEmB,EAAE7C,SAAS0B,EAAEjC,KAAKoD,EAAE,CAAC,QAAQ,GAAGxB,EAAE,MAAMA,EAAEtB,KAAK,CAAC,CAAC,CAAC,OAAOW,EAAEuB,EAAEC,EAAE,GAAG,OAAON,CAAC,CAAC,IAAIF,EAAE,SAASzC,EAAEC,GAAG,OAAOD,EAAE2B,QAAQQ,SAAS,SAASjC,GAAG,IAAIG,EAAEH,EAAEqB,KAAK,OAAOlB,GAAGA,EAAEL,EAAE0B,QAAQzB,EAAG,GAAE,ECdrxF,MAAMgF,EAOJ,WAAAC,CAAaC,EAAWC,EAASC,EAAU,CAAA,GACzCC,KAAKH,UAAYA,EACjBG,KAAKF,QAAUA,EACfE,KAAKD,QAAUA,EACfC,KAAKC,OACN,CAMD,KAAAA,GACE,GAAI,gBAAiBC,YAAcF,KAAKD,QAAQI,cAAe,CAE7D,MAAMC,EAAUF,WAAWG,YAAYC,iBAAiB,cAAcpD,KAAItC,GAAKA,EAAEiB,OAC7DmE,KAAKO,eACNH,EAAQI,SAAS,WAClCR,KAAKS,aAER,CACF,CAMD,QAAAC,CAAUC,GACJA,GACFX,KAAKF,QAAQc,QAAQ,GAAGZ,KAAKH,kBAAmBG,KAAKa,gBAAgBF,IACrEX,KAAKF,QAAQc,QAAQ,GAAGZ,KAAKH,yBAAyB,IAAIiB,MAAOC,UAAUC,aAE3EhB,KAAKS,aAER,CAQD,eAAAI,CAAiBF,GACf,MAAqB,iBAAVA,GAAuBX,KAAKD,QAAQkB,WAA+C,mBAA3BjB,KAAKD,QAAQkB,UACvEC,KAAKC,UAAUnB,KAAKD,QAAQkB,UAAUN,IACnB,iBAAVA,EACTO,KAAKC,UAAUR,GAEjBA,CACR,CAMD,QAAAS,GACE,MAAMT,EAAQX,KAAKF,QAAQuB,QAAQ,GAAGrB,KAAKH,mBAC3C,OAAOc,EAAQO,KAAKI,MAAMX,QAASY,CACpC,CAMD,WAAAhB,GACE,MAAMA,EAAcP,KAAKF,QAAQuB,QAAQ,GAAGrB,KAAKH,yBACjD,OAAOU,EAAciB,SAASjB,EAAa,SAAMgB,CAClD,CAKD,WAAAd,GACET,KAAKF,QAAQ2B,WAAW,GAAGzB,KAAKH,mBAChCG,KAAKF,QAAQ2B,WAAW,GAAGzB,KAAKH,wBACjC,EAUH,SAAS6B,cAAe7B,EAAW8B,EAAc,UAAW5B,GAC1D,OACS,IAAIJ,EAAYE,EADL,UAAhB8B,EACgCzB,WAAW0B,aAEb1B,WAAW2B,eAFgB9B,EAG/D,CC9FO,SAAS+B,kBAAmBC,EAASC,EAASC,GACnD,MAAMC,EAAiB,CACrBC,eAAgBJ,EAChBK,aAAc,CAAE,EAChBC,SAA6B,iBAAZJ,EAAuBP,cAAcO,GAAWA,EACjE,UAAIK,GACF,OAAKtC,KAAKmC,eACHnC,KAAKmC,eAAeG,OADMC,EAAoBC,IAEtD,EACD,SAAI7B,GACF,OAAOX,KAAKmC,eAAexB,KAC5B,EACD,SAAA8B,CAAWC,GACT,OAAO1C,KAAKmC,eAAeM,WAAU,KACnCzC,KAAKoC,aAAe,CAAE,EAClBpC,KAAKqC,UAAYrC,KAAKmC,eAAeG,SAAWC,EAAoBI,SACtE3C,KAAKqC,SAAS3B,SAASV,KAAKmC,eAAexB,OAE7C+B,GAAU,GAEb,EACD,IAAAE,CAAMC,GACJ7C,KAAKmC,eAAeS,KAAKC,EAC1B,EACD,KAAAC,GACE9C,KAAKmC,eAAeW,MAAM9C,KAAKqC,SAAWrC,KAAKqC,SAASjB,gBAAaG,EACtE,GAaH,OAXIS,IACFE,EAAeF,QAAU,IAAIe,MAAMf,EAAS,CAC1C,GAAAgB,CAAKhB,EAASiB,GACZ,IAAKf,EAAeE,aAAaa,GAAM,CACrC,MAAMC,EAASlB,EAAQiB,GAAKf,EAAeC,eAAexB,MAAMvE,SAChE8F,EAAeE,aAAaa,GAAOC,CACpC,CACD,OAAOhB,EAAeE,aAAaa,EACpC,KAGEf,CACT,CAEY,MAACK,EAAsB7F,OAAOyG,OAAO,CAC/CX,MAAO,EACPY,YAAa,EACbT,QAAS,EACTU,QAAS,IC7CX,SAASC,UAAWC,EAASvB,EAASC,GACpC,MAAMF,EAAUD,kBHUqwF,SAAWpH,GAAG,IAAIK,EAAEL,EAAE8C,aAAaxC,EAAEL,EAAEe,WAAWT,EAAE,IAAIuI,IAAIrH,EAAE,CAACsH,SAAS/I,EAAEkI,KAAK,SAAShI,GAAGI,IAAIL,EAAEgB,UAAUZ,EAAEL,EAAE+C,WAAW1C,EAAEH,GAAGuC,EAAEpC,EAAEmB,EAAEtB,IAAIK,EAAE4B,kBAAkBnC,GAAG,OAAOA,EAAEK,EAAG,IAAG,EAAE0H,UAAU,SAAS/H,GAAG,OAAOO,EAAEyI,IAAIhJ,GAAGA,EAAEK,GAAG,CAAC4I,YAAY,WAAW,OAAO1I,EAAE2I,OAAOlJ,EAAE,EAAE,EAAEoI,MAAM,SAAS7H,GAAG,GAAGA,EAAE,CAAC,IAAIiB,EAAE,iBAAiBjB,EAAEA,EAAE,CAACmB,QAAQ1B,EAAE4C,OAAOlB,QAAQb,MAAMN,GAAGF,EAAE,CAACQ,MAAMW,EAAEX,MAAMc,QAAQ,GAAGD,QAAQF,EAAEE,QAAQG,QAAQpB,EAAEe,EAAEX,OAAO,MAAMR,EAAEL,EAAE8C,aAAa,OAAOxC,EAAEL,EAAEgB,QAAQwB,EAAEpC,EAAEH,GAAGuB,CAAC,EAAE0H,KAAK,WAAW,OAAO7I,EAAEL,EAAEiB,QAAQX,EAAE6I,QAAQ3H,CAAC,EAAE,SAAIwE,GAAQ,OAAO5F,CAAC,EAAE,UAAIuH,GAAS,OAAOtH,CAAC,GAAG,OAAOmB,CAAC,CGV9yG4H,CAAgBR,GAAUvB,EAASC,GACrE,OAAOF,CACT,CAEA,SAASiC,oBAAqBf,EAAKM,EAASvB,EAASC,GACnD,MAAMF,EAAUuB,UAAUC,EAASvB,EAASC,GAI5C,OAHA/B,WAAW+D,YAAc/D,WAAW+D,aAAe,CAAE,EACrD/D,WAAW+D,YAAYC,OAAShE,WAAW+D,YAAYC,QAAU,CAAE,EACnEhE,WAAW+D,YAAYC,OAAOjB,GAAOlB,EAC9BA,CACT,CAEA,SAASoC,iBAAkBlB,EAAKlB,GAI9B,OAHA7B,WAAW+D,YAAc/D,WAAW+D,aAAe,CAAE,EACrD/D,WAAW+D,YAAYC,OAAShE,WAAW+D,YAAYC,QAAU,CAAE,EACnEhE,WAAW+D,YAAYC,OAAOjB,GAAOlB,EAC9BA,CACT,CAEA,SAASqC,iBAAkBnB,GACzB,GAAI/C,WAAW+D,aAAe/D,WAAW+D,YAAYC,QAAUhE,WAAW+D,YAAYC,OAAOjB,GAC3F,OAAO/C,WAAW+D,YAAYC,OAAOjB,EAEzC"}