{"version":3,"file":"xstate-service.mjs","sources":["../src/lib/xstate-fsm.mjs","../src/base-persist.mjs","../src/util/wrap-xstate-service.mjs","../src/xstate-service.mjs"],"sourcesContent":["/*! *****************************************************************************\nCopyright (c) Microsoft Corporation.\n\nPermission to use, copy, modify, and/or distribute this software for any\npurpose with or without fee is hereby granted.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\nPERFORMANCE OF THIS SOFTWARE.\n***************************************************************************** */\nfunction t(t,n){var e=\"function\"==typeof Symbol&&t[Symbol.iterator];if(!e)return t;var r,i,o=e.call(t),a=[];try{for(;(void 0===n||n-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(e=o.return)&&e.call(o)}finally{if(i)throw i.error}}return a}var n;!function(t){t[t.NotStarted=0]=\"NotStarted\",t[t.Running=1]=\"Running\",t[t.Stopped=2]=\"Stopped\"}(n||(n={}));var e={type:\"xstate.init\"};function r(t){return void 0===t?[]:[].concat(t)}function i(t){return{type:\"xstate.assign\",assignment:t}}function o(t,n){return\"string\"==typeof(t=\"string\"==typeof t&&n&&n[t]?n[t]:t)?{type:t}:\"function\"==typeof t?{type:t.name,exec:t}:t}function a(t){return function(n){return t===n}}function u(t){return\"string\"==typeof t?{type:t}:t}function c(t,n){return{value:t,context:n,actions:[],changed:!1,matches:a(t)}}function f(t,n,e){var r=n,i=!1;return[t.filter((function(t){if(\"xstate.assign\"===t.type){i=!0;var n=Object.assign({},r);return\"function\"==typeof t.assignment?n=t.assignment(r,e):Object.keys(t.assignment).forEach((function(i){n[i]=\"function\"==typeof t.assignment[i]?t.assignment[i](r,e):t.assignment[i]})),r=n,!1}return!0})),r,i]}function s(n,i){void 0===i&&(i={});var s=t(f(r(n.states[n.initial].entry).map((function(t){return o(t,i.actions)})),n.context,e),2),l=s[0],v=s[1],y={config:n,_options:i,initialState:{value:n.initial,actions:l,context:v,matches:a(n.initial)},transition:function(e,i){var s,l,v=\"string\"==typeof e?{value:e,context:n.context}:e,p=v.value,g=v.context,d=u(i),x=n.states[p];if(x.on){var m=r(x.on[d.type]);try{for(var h=function(t){var n=\"function\"==typeof Symbol&&Symbol.iterator,e=n&&t[n],r=0;if(e)return e.call(t);if(t&&\"number\"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(n?\"Object is not iterable.\":\"Symbol.iterator is not defined.\")}(m),b=h.next();!b.done;b=h.next()){var S=b.value;if(void 0===S)return c(p,g);var w=\"string\"==typeof S?{target:S}:S,j=w.target,E=w.actions,R=void 0===E?[]:E,N=w.cond,O=void 0===N?function(){return!0}:N,_=void 0===j,k=null!=j?j:p,T=n.states[k];if(O(g,d)){var q=t(f((_?r(R):[].concat(x.exit,R,T.entry).filter((function(t){return t}))).map((function(t){return o(t,y._options.actions)})),g,d),3),z=q[0],A=q[1],B=q[2],C=null!=j?j:p;return{value:C,context:A,actions:z,changed:j!==p||z.length>0||B,matches:a(C)}}}}catch(t){s={error:t}}finally{try{b&&!b.done&&(l=h.return)&&l.call(h)}finally{if(s)throw s.error}}}return c(p,g)}};return y}var l=function(t,n){return t.actions.forEach((function(e){var r=e.exec;return r&&r(t.context,n)}))};function v(t){var r=t.initialState,i=n.NotStarted,o=new Set,c={_machine:t,send:function(e){i===n.Running&&(r=t.transition(r,e),l(r,u(e)),o.forEach((function(t){return t(r)})))},subscribe:function(t){return o.add(t),t(r),{unsubscribe:function(){return o.delete(t)}}},start:function(o){if(o){var u=\"object\"==typeof o?o:{context:t.config.context,value:o};r={value:u.value,actions:[],context:u.context,matches:a(u.value)}}else r=t.initialState;return i=n.Running,l(r,e),c},stop:function(){return i=n.Stopped,o.clear(),c},get state(){return r},get status(){return i}};return c}export{n as InterpreterStatus,i as assign,s as createMachine,v as interpret};\n","class BasePersist {\n  /**\n   * Create an instance of persistence with the unique namespace identifier\n   * @param {string} namespace\n   * @param {object} storage\n   * @param {object} options\n   */\n  constructor (namespace, storage, options = {}) {\n    this.namespace = namespace\n    this.storage = storage\n    this.options = options\n    this._init()\n  }\n\n  /**\n   * Private method for initializing\n   * @private\n   */\n  _init () {\n    if ('performance' in globalThis && this.options.clearOnReload) {\n      // @ts-ignore\n      const entries = globalThis.performance.getEntriesByType('navigation').map(e => e.type)\n      const lastUpdated = this.lastUpdated()\n      if (lastUpdated && entries.includes('reload')) {\n        this.removeState()\n      }\n    }\n  }\n\n  /**\n   * Set state in the persistence store\n   * @param {*} state\n   */\n  setState (state) {\n    if (state) {\n      this.storage.setItem(`${this.namespace}:state`, this._normalizeState(state))\n      this.storage.setItem(`${this.namespace}:lastUpdated`, new Date().getTime().toString())\n    } else {\n      this.removeState()\n    }\n  }\n\n  /**\n   * Normalize state before persisting\n   * @param state\n   * @returns {string}\n   * @private\n   */\n  _normalizeState (state) {\n    if (typeof state === 'object' && (this.options.saveState && typeof this.options.saveState === 'function')) {\n      return JSON.stringify(this.options.saveState(state))\n    } else if (typeof state !== 'string') {\n      return JSON.stringify(state)\n    }\n    return state\n  }\n\n  /**\n   * Get state from the persistence store\n   * @returns {*}\n   */\n  getState () {\n    const state = this.storage.getItem(`${this.namespace}:state`)\n    return state ? JSON.parse(state) : undefined\n  }\n\n  /**\n   * Get the last updated time in milliseconds since the Unix Epoch\n   * @returns {number}\n   */\n  lastUpdated () {\n    const lastUpdated = this.storage.getItem(`${this.namespace}:lastUpdated`)\n    return lastUpdated ? parseInt(lastUpdated, 10) : undefined\n  }\n\n  /**\n   * Remove state from the persistence store\n   */\n  removeState () {\n    this.storage.removeItem(`${this.namespace}:state`)\n    this.storage.removeItem(`${this.namespace}:lastUpdated`)\n  }\n}\n\n/**\n * Function to create persistence for the store\n * @param {string} namespace\n * @param {string} [storageName]\n * @param {object} [options]\n * @returns {BasePersist}\n */\nfunction createPersist (namespace, storageName = 'session', options) {\n  if (storageName === 'local') {\n    return new BasePersist(namespace, globalThis.localStorage, options)\n  }\n  return new BasePersist(namespace, globalThis.sessionStorage, options)\n}\n\nexport { BasePersist, createPersist }\n","import { createPersist } from '../base-persist.mjs'\n\nexport function wrapXStateService (service, getters, persist) {\n  const wrappedService = {\n    _xstateService: service,\n    _getterCache: {},\n    _persist: typeof persist === 'string' ? createPersist(persist) : persist,\n    get status () {\n      if (!this._xstateService) return XStateServiceStatus.INIT\n      return this._xstateService.status\n    },\n    get state () {\n      return this._xstateService.state\n    },\n    subscribe (callback) {\n      return this._xstateService.subscribe(() => {\n        this._getterCache = {}\n        if (this._persist && this._xstateService.status === XStateServiceStatus.RUNNING) {\n          this._persist.setState(this._xstateService.state)\n        }\n        callback()\n      })\n    },\n    send (action) {\n      this._xstateService.send(action)\n    },\n    start () {\n      this._xstateService.start(this._persist ? this._persist.getState() : undefined)\n    }\n  }\n  if (getters) {\n    wrappedService.getters = new Proxy(getters, {\n      get (getters, key) {\n        if (!wrappedService._getterCache[key]) {\n          const result = getters[key](wrappedService._xstateService.state.context)\n          wrappedService._getterCache[key] = result\n        }\n        return wrappedService._getterCache[key]\n      }\n    })\n  }\n  return wrappedService\n}\n\nexport const XStateServiceStatus = Object.freeze({\n  INIT: -1,\n  NOT_STARTED: 0,\n  RUNNING: 1,\n  STOPPED: 2\n})\n","import { assign, createMachine, interpret as interpretXState } from './lib/xstate-fsm.mjs'\nimport { wrapXStateService, XStateServiceStatus } from './util/wrap-xstate-service.mjs'\n\nfunction interpret (machine, getters, persist) {\n  const service = wrapXStateService(interpretXState(machine), getters, persist)\n  return service\n}\n\nfunction createXStateService (key, machine, getters, persist) {\n  const service = interpret(machine, getters, persist)\n  globalThis.__ficusjs__ = globalThis.__ficusjs__ || {}\n  globalThis.__ficusjs__.xstate = globalThis.__ficusjs__.xstate || {}\n  globalThis.__ficusjs__.xstate[key] = service\n  return service\n}\n\nfunction addXStateService (key, service) {\n  globalThis.__ficusjs__ = globalThis.__ficusjs__ || {}\n  globalThis.__ficusjs__.xstate = globalThis.__ficusjs__.xstate || {}\n  globalThis.__ficusjs__.xstate[key] = service\n  return service\n}\n\nfunction getXStateService (key) {\n  if (globalThis.__ficusjs__ && globalThis.__ficusjs__.xstate && globalThis.__ficusjs__.xstate[key]) {\n    return globalThis.__ficusjs__.xstate[key]\n  }\n}\n\nexport {\n  XStateServiceStatus,\n  addXStateService,\n  assign,\n  createMachine,\n  createXStateService,\n  getXStateService,\n  interpret,\n  wrapXStateService\n}\n"],"names":["t","n","e","Symbol","iterator","r","i","o","call","a","next","done","push","value","error","return","NotStarted","Running","Stopped","type","concat","assignment","name","exec","u","c","context","actions","changed","matches","f","filter","Object","assign","keys","forEach","s","states","initial","entry","map","l","v","y","config","_options","initialState","transition","p","g","d","x","on","m","h","length","TypeError","b","S","w","target","j","E","R","N","cond","O","_","k","T","q","exit","z","A","B","C","BasePersist","constructor","namespace","storage","options","this","_init","globalThis","clearOnReload","entries","performance","getEntriesByType","lastUpdated","includes","removeState","setState","state","setItem","_normalizeState","Date","getTime","toString","saveState","JSON","stringify","getState","getItem","parse","undefined","parseInt","removeItem","createPersist","storageName","localStorage","sessionStorage","wrapXStateService","service","getters","persist","wrappedService","_xstateService","_getterCache","_persist","status","XStateServiceStatus","INIT","subscribe","callback","RUNNING","send","action","start","Proxy","get","key","result","freeze","NOT_STARTED","STOPPED","interpret","machine","Set","_machine","add","unsubscribe","delete","stop","clear","interpretXState","createXStateService","__ficusjs__","xstate","addXStateService","getXStateService"],"mappings":"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"}