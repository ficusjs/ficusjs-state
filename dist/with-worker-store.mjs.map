{"version":3,"file":"with-worker-store.mjs","sources":["../src/with-worker-store.mjs"],"sourcesContent":["export function withWorkerStore (worker, options) {\n  return {\n    ...options,\n    created () {\n      const that = this\n      that.worker = worker\n      globalThis.__ficusjs__ = globalThis.__ficusjs__ || {}\n      globalThis.__ficusjs__.workers = globalThis.__ficusjs__.workers || new Map()\n      if (!globalThis.__ficusjs__.workers.has(worker)) {\n        const elements = new Set()\n        elements.add(that)\n        globalThis.__ficusjs__.workers.set(worker, elements)\n      } else {\n        const elements = globalThis.__ficusjs__.workers.get(worker)\n        if (!elements.has(that)) {\n          elements.add(that)\n        }\n      }\n      if (!worker.onmessage) {\n        that.worker.onmessage = e => {\n          const elements = globalThis.__ficusjs__.workers.get(worker)\n          for (const element of elements) {\n            element.state = e.data\n            // clear the getter cache\n            element.computedCache = {}\n            // Run the render processor now that there's changes\n            element._processRender.apply(element)\n          }\n        }\n      }\n      that.store = {\n        dispatch (actionName, payload) {\n          that.worker.postMessage({ actionName, payload })\n        }\n      }\n      if (options.created) options.created.call(that)\n    }\n  }\n}\n"],"names":["withWorkerStore","worker","options","created","that","this","globalThis","__ficusjs__","workers","Map","has","elements","get","add","Set","set","onmessage","e","element","state","data","computedCache","_processRender","apply","store","dispatch","actionName","payload","postMessage","call"],"mappings":"AAAO,SAASA,gBAAiBC,EAAQC,GACvC,MAAO,IACFA,EACH,OAAAC,GACE,MAAMC,EAAOC,KAIb,GAHAD,EAAKH,OAASA,EACdK,WAAWC,YAAcD,WAAWC,aAAe,CAAE,EACrDD,WAAWC,YAAYC,QAAUF,WAAWC,YAAYC,SAAW,IAAIC,IAClEH,WAAWC,YAAYC,QAAQE,IAAIT,GAIjC,CACL,MAAMU,EAAWL,WAAWC,YAAYC,QAAQI,IAAIX,GAC/CU,EAASD,IAAIN,IAChBO,EAASE,IAAIT,EAEhB,KATgD,CAC/C,MAAMO,EAAW,IAAIG,IACrBH,EAASE,IAAIT,GACbE,WAAWC,YAAYC,QAAQO,IAAId,EAAQU,EACnD,CAMWV,EAAOe,YACVZ,EAAKH,OAAOe,UAAYC,IACtB,MAAMN,EAAWL,WAAWC,YAAYC,QAAQI,IAAIX,GACpD,IAAK,MAAMiB,KAAWP,EACpBO,EAAQC,MAAQF,EAAEG,KAElBF,EAAQG,cAAgB,CAAE,EAE1BH,EAAQI,eAAeC,MAAML,EAC9B,GAGLd,EAAKoB,MAAQ,CACX,QAAAC,CAAUC,EAAYC,GACpBvB,EAAKH,OAAO2B,YAAY,CAAEF,aAAYC,WACvC,GAECzB,EAAQC,SAASD,EAAQC,QAAQ0B,KAAKzB,EAC3C,EAEL"}