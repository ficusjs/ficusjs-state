{"version":3,"file":"with-state-machine.mjs","sources":["../src/state-machine.mjs","../src/with-state-machine.mjs"],"sourcesContent":["class StateMachine {\n  /**\n   * Create an instance of a state machine\n   * @param {object} machine\n   */\n  constructor (machine) {\n    this.machine = machine\n  }\n\n  /**\n   * Property to return the initial state\n   * @property\n   * @returns {string}\n   */\n  get initialState () {\n    return this.machine.initial || Object.keys(this.machine.states)[0]\n  }\n\n  /**\n   * Method to transition to another state based on the event\n   * @param {string} state\n   * @param {string} event\n   * @returns {string}\n   */\n  transition (state, event) {\n    return this.machine.states[state].on[event]\n  }\n}\n\n/**\n * Function to create a state machine\n * @param {object} machine\n * @returns {StateMachine}\n */\nexport function createStateMachine (machine) {\n  return new StateMachine(machine)\n}\n","import { createStateMachine } from './state-machine.mjs'\n\nexport function withStateMachine (stateMachineDefinition, options) {\n  return {\n    ...options,\n    created () {\n      this._stateMachineDefinition = stateMachineDefinition\n      this._stateMachine = createStateMachine(stateMachineDefinition)\n      this.initialState = this._stateMachine.initialState\n      this.state = {\n        context: {},\n        matches (v) {\n          return v === this.value\n        },\n        value: this.initialState\n      }\n      this.setState = (data, callback) => {\n        if (!data || typeof data !== 'object') return\n        const existingUpdated = this.updated\n        if (callback) {\n          this.updated = () => {\n            callback.call(this)\n            this.updated = existingUpdated || undefined\n          }\n        }\n        this.status = 'transaction'\n        for (const key in data) {\n          if (key === 'value') {\n            this.state[key] = data[key]\n          } else if (!this.state.context[key] || (this.state.context[key] !== data[key])) {\n            this.state.context[key] = data[key]\n          }\n        }\n        this.status = 'render'\n        this._processRender()\n      }\n      if (options.created) options.created.call(this)\n    },\n    send (event) {\n      let eventType\n      let eventPayload\n      if (typeof event === 'string') {\n        eventType = event\n      } else {\n        const { type, ...payload } = event\n        eventType = type\n        eventPayload = payload\n      }\n      const { value } = this.state\n      const nextState = this._stateMachine.transition(value, eventType) || value\n      const nextStateValue = typeof nextState === 'object' && nextState.target ? nextState.target : nextState\n      const nextStateAction = typeof nextState === 'object' && nextState.action ? nextState.action : nextState\n      const action = this._stateMachineDefinition.actions && this._stateMachineDefinition.actions[nextStateAction]\n        ? () => this._stateMachineDefinition.actions[nextStateAction].call(this, eventPayload)\n        : () => {}\n      this.setState({ value: nextStateValue }, action)\n    }\n  }\n}\n"],"names":["StateMachine","constructor","machine","this","initialState","initial","Object","keys","states","transition","state","event","on","withStateMachine","stateMachineDefinition","options","created","_stateMachineDefinition","_stateMachine","context","matches","v","value","setState","data","callback","existingUpdated","updated","call","undefined","status","key","_processRender","send","eventType","eventPayload","type","payload","nextState","nextStateValue","target","nextStateAction","action","actions"],"mappings":"AAAA,MAAMA,EAKJ,WAAAC,CAAaC,GACXC,KAAKD,QAAUA,CAChB,CAOD,gBAAIE,GACF,OAAOD,KAAKD,QAAQG,SAAWC,OAAOC,KAAKJ,KAAKD,QAAQM,QAAQ,EACjE,CAQD,UAAAC,CAAYC,EAAOC,GACjB,OAAOR,KAAKD,QAAQM,OAAOE,GAAOE,GAAGD,EACtC,ECxBI,SAASE,iBAAkBC,EAAwBC,GACxD,MAAO,IACFA,EACH,OAAAC,GACEb,KAAKc,wBAA0BH,EAC/BX,KAAKe,cD4BF,IAAIlB,EC5BiCc,GACxCX,KAAKC,aAAeD,KAAKe,cAAcd,aACvCD,KAAKO,MAAQ,CACXS,QAAS,CAAE,EACX,OAAAC,CAASC,GACP,OAAOA,IAAMlB,KAAKmB,KACnB,EACDA,MAAOnB,KAAKC,cAEdD,KAAKoB,SAAW,CAACC,EAAMC,KACrB,IAAKD,GAAwB,iBAATA,EAAmB,OACvC,MAAME,EAAkBvB,KAAKwB,QACzBF,IACFtB,KAAKwB,QAAU,KACbF,EAASG,KAAKzB,MACdA,KAAKwB,QAAUD,QAAmBG,CAAS,GAG/C1B,KAAK2B,OAAS,cACd,IAAK,MAAMC,KAAOP,EACJ,UAARO,EACF5B,KAAKO,MAAMqB,GAAOP,EAAKO,GACb5B,KAAKO,MAAMS,QAAQY,IAAS5B,KAAKO,MAAMS,QAAQY,KAASP,EAAKO,KACvE5B,KAAKO,MAAMS,QAAQY,GAAOP,EAAKO,IAGnC5B,KAAK2B,OAAS,SACd3B,KAAK6B,gBAAgB,EAEnBjB,EAAQC,SAASD,EAAQC,QAAQY,KAAKzB,KAC3C,EACD,IAAA8B,CAAMtB,GACJ,IAAIuB,EACAC,EACJ,GAAqB,iBAAVxB,EACTuB,EAAYvB,MACP,CACL,MAAMyB,KAAEA,KAASC,GAAY1B,EAC7BuB,EAAYE,EACZD,EAAeE,CAChB,CACD,MAAMf,MAAEA,GAAUnB,KAAKO,MACjB4B,EAAYnC,KAAKe,cAAcT,WAAWa,EAAOY,IAAcZ,EAC/DiB,EAAsC,iBAAdD,GAA0BA,EAAUE,OAASF,EAAUE,OAASF,EACxFG,EAAuC,iBAAdH,GAA0BA,EAAUI,OAASJ,EAAUI,OAASJ,EACzFI,EAASvC,KAAKc,wBAAwB0B,SAAWxC,KAAKc,wBAAwB0B,QAAQF,GACxF,IAAMtC,KAAKc,wBAAwB0B,QAAQF,GAAiBb,KAAKzB,KAAMgC,GACvE,OACJhC,KAAKoB,SAAS,CAAED,MAAOiB,GAAkBG,EAC1C,EAEL"}