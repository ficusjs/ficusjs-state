{"version":3,"file":"persist.mjs","sources":["../src/base-persist.mjs"],"sourcesContent":["class BasePersist {\n  /**\n   * Create an instance of persistence with the unique namespace identifier\n   * @param {string} namespace\n   * @param {object} storage\n   * @param {object} options\n   */\n  constructor (namespace, storage, options = {}) {\n    this.namespace = namespace\n    this.storage = storage\n    this.options = options\n    this._init()\n  }\n\n  /**\n   * Private method for initializing\n   * @private\n   */\n  _init () {\n    if ('performance' in globalThis && this.options.clearOnReload) {\n      // @ts-ignore\n      const entries = globalThis.performance.getEntriesByType('navigation').map(e => e.type)\n      const lastUpdated = this.lastUpdated()\n      if (lastUpdated && entries.includes('reload')) {\n        this.removeState()\n      }\n    }\n  }\n\n  /**\n   * Set state in the persistence store\n   * @param {*} state\n   */\n  setState (state) {\n    if (state) {\n      this.storage.setItem(`${this.namespace}:state`, this._normalizeState(state))\n      this.storage.setItem(`${this.namespace}:lastUpdated`, new Date().getTime().toString())\n    } else {\n      this.removeState()\n    }\n  }\n\n  /**\n   * Normalize state before persisting\n   * @param state\n   * @returns {string}\n   * @private\n   */\n  _normalizeState (state) {\n    if (typeof state === 'object' && (this.options.saveState && typeof this.options.saveState === 'function')) {\n      return JSON.stringify(this.options.saveState(state))\n    } else if (typeof state !== 'string') {\n      return JSON.stringify(state)\n    }\n    return state\n  }\n\n  /**\n   * Get state from the persistence store\n   * @returns {*}\n   */\n  getState () {\n    const state = this.storage.getItem(`${this.namespace}:state`)\n    return state ? JSON.parse(state) : undefined\n  }\n\n  /**\n   * Get the last updated time in milliseconds since the Unix Epoch\n   * @returns {number}\n   */\n  lastUpdated () {\n    const lastUpdated = this.storage.getItem(`${this.namespace}:lastUpdated`)\n    return lastUpdated ? parseInt(lastUpdated, 10) : undefined\n  }\n\n  /**\n   * Remove state from the persistence store\n   */\n  removeState () {\n    this.storage.removeItem(`${this.namespace}:state`)\n    this.storage.removeItem(`${this.namespace}:lastUpdated`)\n  }\n}\n\n/**\n * Function to create persistence for the store\n * @param {string} namespace\n * @param {string} [storageName]\n * @param {object} [options]\n * @returns {BasePersist}\n */\nfunction createPersist (namespace, storageName = 'session', options) {\n  if (storageName === 'local') {\n    return new BasePersist(namespace, globalThis.localStorage, options)\n  }\n  return new BasePersist(namespace, globalThis.sessionStorage, options)\n}\n\nexport { BasePersist, createPersist }\n"],"names":["BasePersist","constructor","namespace","storage","options","this","_init","globalThis","clearOnReload","entries","performance","getEntriesByType","map","e","type","lastUpdated","includes","removeState","setState","state","setItem","_normalizeState","Date","getTime","toString","saveState","JSON","stringify","getState","getItem","parse","undefined","parseInt","removeItem","createPersist","storageName","localStorage","sessionStorage"],"mappings":"AAAA,MAAMA,EAOJC,YAAaC,EAAWC,EAASC,EAAU,CAAA,GACzCC,KAAKH,UAAYA,EACjBG,KAAKF,QAAUA,EACfE,KAAKD,QAAUA,EACfC,KAAKC,OACN,CAMDA,QACE,GAAI,gBAAiBC,YAAcF,KAAKD,QAAQI,cAAe,CAE7D,MAAMC,EAAUF,WAAWG,YAAYC,iBAAiB,cAAcC,KAAIC,GAAKA,EAAEC,OAC7DT,KAAKU,eACNN,EAAQO,SAAS,WAClCX,KAAKY,aAER,CACF,CAMDC,SAAUC,GACJA,GACFd,KAAKF,QAAQiB,QAAQ,GAAGf,KAAKH,kBAAmBG,KAAKgB,gBAAgBF,IACrEd,KAAKF,QAAQiB,QAAQ,GAAGf,KAAKH,yBAAyB,IAAIoB,MAAOC,UAAUC,aAE3EnB,KAAKY,aAER,CAQDI,gBAAiBF,GACf,MAAqB,iBAAVA,GAAuBd,KAAKD,QAAQqB,WAA+C,mBAA3BpB,KAAKD,QAAQqB,UACvEC,KAAKC,UAAUtB,KAAKD,QAAQqB,UAAUN,IACnB,iBAAVA,EACTO,KAAKC,UAAUR,GAEjBA,CACR,CAMDS,WACE,MAAMT,EAAQd,KAAKF,QAAQ0B,QAAQ,GAAGxB,KAAKH,mBAC3C,OAAOiB,EAAQO,KAAKI,MAAMX,QAASY,CACpC,CAMDhB,cACE,MAAMA,EAAcV,KAAKF,QAAQ0B,QAAQ,GAAGxB,KAAKH,yBACjD,OAAOa,EAAciB,SAASjB,EAAa,SAAMgB,CAClD,CAKDd,cACEZ,KAAKF,QAAQ8B,WAAW,GAAG5B,KAAKH,mBAChCG,KAAKF,QAAQ8B,WAAW,GAAG5B,KAAKH,wBACjC,EAUH,SAASgC,cAAehC,EAAWiC,EAAc,UAAW/B,GAC1D,OACS,IAAIJ,EAAYE,EADL,UAAhBiC,EACgC5B,WAAW6B,aAEb7B,WAAW8B,eAFgBjC,EAG/D"}